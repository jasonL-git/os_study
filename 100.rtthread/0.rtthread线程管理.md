# 线程管理

## 线程管理功能特点

Rt-thread主要是对线程进行管理和调度，包括系统线程和用户线程

* 系统线程：由rtthread内核创建的线程

* 用户线程：由应用程序创建的线程

Rt-thread线程调度器特点：

* 抢占式

* 从线程就绪列表中，找出优先级最高的线程

* 当调度器线程切换时，先把当前线程上下文保存，再切回当前进程，恢复该线程的上下文恢复

## 线程属性

### 线程栈

RT-Thread 线程具有独立的栈，当进行线程切换时，会将当前线程的上下文存在栈中，当线程要恢复运行时，再从栈中读取上下文信息，进行恢复。

对于线程第一次运行，可以以手工的方式构造这个上下文来设置一些初始的环境：**入口函数（PC 寄存器）、入口参数（R0 寄存器）、返回位置（LR 寄存器）、当前机器运行状态（CPSR 寄存器）**

<img title="" src="pic/stack.png" alt="pstree" width="262">

### 线程优先级

RT-Thread 最大支持 256 个线程优先级 (0~255) `数值越小的优先级越高，0 为最高优先级`。

* 最低优先级默认分配给空闲线程使用，用户一般不使用

* 在系统中，当有比当前线程优先级更高的线程就绪时，当前线程将立刻被换出，高优先级线程抢占处理器运行

## 线程管理方式

线程相关操作

![pstree](pic/thread_api.png)

有两种线程：动态线程和静态线程

* **动态线程：** 系统自动从动态内存堆上分配栈空间与线程句柄（初始化 heap 之后才能使用 create 创建动态线程）

* **静态线程：** 由用户分配栈空间与线程句柄


