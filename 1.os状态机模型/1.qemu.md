# 使用qemu启动a9开发板

## 安装qemu

> sudo apt intall qemu

## 安装交叉编译环境

arm-linux-gnueabi-

## linux源码下载

直接修改顶层Makefile

![makefile](pic/qemu-makefile.png)

## 启动

### 需要的东西

1. zImage，前面Linux内核生成的内核镜像，a9生成的在 ./arch/arm/boot/zImage

2. dtb（设备树文件），也跟着前面一起生成了，./arch/arm/boot/dts/arm/vexpress-v2p-ca9.dtb

3. 根文件系统（rootfs），使用busybox做一个就行

4. qemu，qemu-system-arm、qemu-system-riscv都行

ARM架构启动一般是这样：

```bash
qemu-system-arm -M virt \
  -kernel zImage \
  -dtb virt.dtb \
  -append "console=ttyAMA0 root=/dev/vda" \
  -hda rootfs.img \
  -nographic

```

### 构建initrd

- 使用工具（如 `busybox`）制作最小化的文件系统：
  
  bash
  
  复制代码
  
  `mkdir -p rootfs/{bin,sbin,etc,proc,sys,usr/{bin,sbin}} cp busybox rootfs/bin/`

- 打包为 cpio 格式：
  
  bash
  
  复制代码
  
  `cd rootfs && find . | cpio -o --format=newc > initrd.img`



qemu-system-arm -M vexpress-a9 -kernel arch/arm/boot/zImage -dtb arch/arm/boot/dts/arm/vexpress-v2p-ca9.dtb -initrd ../busybox/rootfs/initrd.img.gz -append "console=ttyAMA0" -nographic

init镜像有问题


